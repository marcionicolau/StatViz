<!-- Skeleton for VizStat -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" type="text/css" href="style/skeleton.css">
        <meta charset="utf-8">
        <title>VizStat</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <script src="opencpu/jquery-1.10.1.min.js"></script>
        <script src="opencpu/opencpu.js"></script>
    </head>
    <body>        
        <script type="text/javascript">
            var width = document.width;
            var height = document.height;
            var global;
        
            window.onload = function()
            { 
                // Set the width and height of panels
                variablesPanel = d3.select("#variables.panel");
                visualizationsPanel = d3.select("#visualizations.panel");
        
                variablesPanel.attr("style", "width: " + width*0.25 + "px; height: " + height + "px;");    
                visualizationsPanel.attr("style", "width: " + width*0.75 + "px; height: " + height/3 + "px; top: " + height*(2/3) + "px; left: " + width*0.25 + "px;");    
                
                // Load dataset variables
                getVariables("beaver1");
            }
            
            function getVariables(dataset)
            {   
                // Get variable names and their data type
                var req = opencpu.r_fun_json("getVariableNames", {
                                dataset: dataset
                              }, function(output) {
                   $("#test").text(output.varNames);
                   renderVariableNames(output.varNames);
                  }).fail(function(){
                      alert("Failure: " + req.responseText);
                });
        
                //if R returns an error, alert the error message
                req.fail(function(){
                  alert("Server error: " + req.responseText);
                });
                
                console.log("global: " + global);
            }
            
            function renderVariableNames(variableNames)
            {
                console.log("Rendering " + variableNames);
                
                var variablesPanel = d3.select("#variables.panel");                
                var variablesPanelWidth = variablesPanel.style("width");
                
                var variableNameHolder.padding = 10;
                var variableNameHolder.width = variablesPanelWidth - 2*variableNameHolder.padding;                
                var variableNameHolder.height = 50;
                
                var variablesPanelSVG = variablesPanel.append("svg");                
                variablesPanelSVG.attr("id","variablesPanelSVG")
                                            .attr("height", variablesPanel.style("height"))
                                            .attr("width", variablesPanelWidth)
                                            .attr("left", variablesPanel.style("left"))
                                            .attr("top", variablesPanel.style("top"));  
                
                variablesPanelSVG.append("rect")
                                                .attr("x", variableNameHolder.padding)
                                                .attr("y", variableNameHolder.padding)
                                                .attr("height", variableNameHolder.height)
                                                .attr("width",  variableNameHolder.width)     
                                                .attr("fill", "silver");                                     
            }
        </script>
        
        <div id="variables" class="panel"></div>
        <div id="visualizations" class="panel"></div>
        <p id="test"></p>
        
        <span id="variableList"></span>
    </body>
</html>   
